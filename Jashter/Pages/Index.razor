@page "/"
@inject HttpClient _http
@inject NavigationManager _navigationManager
@inject ILocalStorageService _localStorage
<PageTitle>Jashter</PageTitle>
<div class="p-2 mx-auto" style="max-width: 500px;">
    <div class="d-flex">
        <div class="m-auto ms-2">
            <div class="title">Jashter</div>
        </div>
        <div class="m-auto me-2 profile-icon">
            @if(_user is null)
            {
                <div>Guest</div>
            }
            else
            {
                <div>@_user.FirstName.Substring(0,1)@_user.LastName.Substring(0,1)</div>
            }
        </div>
    </div>
</div>
@code {
    private string? _token;
    private string? _jwt;
    private User? _user;
    protected override async Task OnInitializedAsync()
    {
        _jwt = await _localStorage.GetItemAsStringAsync("JWT");
        if (_jwt is null)
        {
            _navigationManager.NavigateTo("login");
        }
        else
        {
            HttpRequestMessage requestMessage = new HttpRequestMessage(HttpMethod.Get, "user/get");
            requestMessage.Headers.Add("Authorization", "Bearer " + _jwt);
            HttpResponseMessage responseMessage = await _http.SendAsync(requestMessage);
            responseMessage.EnsureSuccessStatusCode();
            _user = await responseMessage.Content.ReadFromJsonAsync<User>();
        }
        StateHasChanged();
    }
}